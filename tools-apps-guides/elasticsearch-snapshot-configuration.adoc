---
permalink: tools-apps-guides/elasticsearch-snapshot-configuration.html 
sidebar: sidebar 
keywords: Elastic, Elasticsearch, snapshot, repository, StorageGRID, object storage 
summary: Anweisungen zum Erstellen eines Elasticsearch-Snapshot-Repository zur Verwendung des StorageGRID -Objektspeichers. 
---
= Konfiguration des Elasticsearch-Snapshot-Repository
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
_Von Angela Cheng_

Elasticsearch unterstützt die Verwendung von AWS S3-kompatiblem Objektspeicher für Snapshot-Repositorys.  Dieser Artikel enthält schrittweise Anweisungen zum Erstellen eines Elasticsearch S3-Snapshot-Repository mit StorageGRID als Backend-Objektspeicher.



== Anforderungen

* StorageGRID 11.8 oder höher
* Elasticsearch 8.x oder höher




== Annahme

Die Leser sind mit der Terminologie und den Vorgängen von StorageGRID und Elasticsearch vertraut.



== Anweisung

*Schritte*

. Erstellen Sie einen StorageGRID Bucket zur Verwendung für das Elasticsearch-Snapshot-Repository.  Die Bucket-Versionierung muss aktiviert sein.  Verwenden Sie einen Bucket pro Repository.  Geben Sie einen Bucket nicht für mehrere Repositories oder Elasticsearch-Cluster frei.
. Fügen Sie den StorageGRID Mandantenzugriffsschlüssel und den geheimen Schlüssel zum Elasticsearch-Schlüsselspeicher hinzu.  Melden Sie sich beim Elasticsearch-Masterknoten an, navigieren Sie zum `<elasticsearch>/bin/` Verzeichnis und verwenden `elasticsearch-keystore` um den Zugriffsschlüssel und den geheimen Schlüssel hinzuzufügen.
+
Beispielbefehl:

+
[NOTE]
====
 In older Elasticsearch versions, the key names are `access.key` and `secret.key` instead of using underscores.
====
+
[listing]
----
/usr/share/elasticsearch/bin/elasticsearch-keystore add s3.client.sgdemo.access_key
Enter value for s3.client.sgdemo.access_key: <paste the access key here, it will not be displayed>

/usr/share/elasticsearch/bin/elasticsearch-keystore add s3.client.sgdemo.secret_key
Enter value for s3.client.sgdemo.secret_key: <paste the secret key here, it will not be displayed>
----
+
Um die Schlüssel anzuzeigen, verwenden Sie den Befehl „elasticsearch-keystore show <Schlüsselname>“.

. Wiederholen Sie bei Elasticsearch-Clustern mit mehreren Knoten Schritt 2 in jedem Knoten oder konsultieren Sie die Elasticsearch-Dokumentation.
. Navigieren Sie von der Kibana-Web-GUI zur Seite „Dev Tools Console“ und verwenden Sie `POST _nodes/reload_secure_settings` API zum Anwenden der Änderungen auf jeden Knoten.
+
image:es-snapshot/es-reload-api.png["Beispiel-Screenshot von reload_secure_settings"]

. Verwenden Sie die `PUT _snapshot` API zum Erstellen eines neuen Snapshot-Repository.
+
In diesem Beispiel lautet der Repository-Name `sg_snapshot_repository` , und die Puffergröße entspricht der Teilgröße des mehrteiligen S3-Uploads.

+
Das Standardprotokoll ist HTTPS.  Um HTTP mit dem StorageGRID S3-Endpunkt zu verwenden, fügen Sie hinzu `"protocol": "http"` zu den Einstellungen.

+
Verwenden Sie den in Schritt 1 erstellten Bucket-Namen und den in Schritt 2 konfigurierten Client-Namen.

+
[listing]
----
PUT _snapshot/sg_snapshot_repository
{
  "type": "s3",
  "settings": {
    "bucket": "elk-snapshot",
    "client": "sgdemo",
    "path_style_access": "true",
    "endpoint": "sgdemo.netapp.com",
    "buffer_size": "512mb"
  }
}
----
+
image:es-snapshot/es-create-repository-api.png["Screenshot des Beispiels der Elasticsearch-API"]

. Navigieren Sie in der Kibana-Web-GUI zur Seite „Stack-Verwaltung > Snapshot und Wiederherstellung“ und wählen Sie die Registerkarte „Repositorys“ aus.
+
Klicken Sie auf den Repository-Namen, um die Details anzuzeigen oder einige Einstellungen zu ändern, z. B. die maximale Anzahl an Snapshot-Bytes pro Sekunde, die standardmäßig auf 40 MB/s pro Elasticsearch-Knoten eingestellt ist.

+
Für Einstellungen, die auf dieser Seite nicht sichtbar sind, verwenden Sie die `PUT _snapshot` API in der Dev Tools Console, um Änderungen vorzunehmen.

+
image:es-snapshot/es-snapshot-repository.png["Beispiel-Screenshot des Snapshot-Repository"]

. Richten Sie eine Bucket-Lebenszyklusrichtlinie ein, um Objekte nicht aktueller Versionen im Snapshot-Bucket zu verwalten.  Entfernen Sie beispielsweise nicht aktuelle Versionen nach 90 Tagen.
. Elastic verlangt von Clients, den Nicht-AWS-S3-Speicher zu validieren, bevor er ihn zum Speichern von Snapshots verwendet.
+
Befolgen Sie die Anweisungen von Elastic, um die Einrichtung zu bestätigen:

+
https://www.elastic.co/docs/api/doc/elasticsearch/operation/operation-snapshot-repository-analyze[]

. Befolgen Sie nach der Validierung die Anleitung von Elasticsearch, um eine Richtlinie zum Speichern nächtlicher Snapshots zu erstellen.




== Weitere Ressourcen

* https://www.elastic.co/docs/api/doc/elasticsearch/group/endpoint-snapshot["Elasticsearch S3-Repository"]
* https://docs.netapp.com/us-en/storagegrid/ilm/how-objects-are-deleted.html#delete-s3-versioned-objects["So werden versionierte S3-Objekte gelöscht"]

